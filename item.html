<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>OCSI IT Inventory ‚Äì Device Details</title>

<style>
:root{--bg:#0f172a;--bg2:#0b1020;--brand:#1a73e8;--border:#e5e7eb;}
*{box-sizing:border-box;}
body{margin:0;font-family:system-ui;background:#f5f7fb;}
.topbar{position:sticky;top:0;background:var(--bg);color:white;padding:12px 16px;display:flex;justify-content:space-between;}
.layout{display:grid;grid-template-columns:240px 1fr;min-height:calc(100vh - 52px);}
.sidebar{background:var(--bg2);color:white;padding:14px;}
.content{padding:18px;max-width:1100px;margin:auto;}
.toolbar{display:flex;gap:8px;justify-content:flex-end;margin-bottom:12px;}
.btn{padding:6px 12px;border-radius:999px;border:none;font-size:.85rem;cursor:pointer;display:inline-flex;gap:6px;}
.btn-primary{background:var(--brand);color:white;}
.btn-ghost{background:white;border:1px solid #cbd5e1;}
.card{background:white;border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:12px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px 16px;}
.field-label{font-size:.75rem;color:#94a3b8;}
.field-value{font-size:.9rem;}
.status{padding:3px 9px;border-radius:999px;background:#e5f3ff;color:#1d4ed8;font-size:.75rem;}
</style>
</head>

<body>
<div class="topbar">
  <strong>OCSI IT Inventory</strong>
  <div id="who">Checking session‚Ä¶</div>
</div>

<div class="layout">
  <aside class="sidebar" id="sidebar-root"></aside>
  <main class="content">

    <h1 id="title">Device</h1>
    <div id="subtitle" style="color:#64748b;margin-bottom:10px;">Loading‚Ä¶</div>

    <div class="toolbar">
      <a id="editLink" class="btn btn-primary">‚úèÔ∏è Edit</a>
      <a id="qrLink" class="btn btn-ghost" target="_blank">üìé QR Code</a>
      <button class="btn btn-ghost" onclick="history.back()">‚¨Ö Back</button>
    </div>

    <section class="card">
      <h3>Identification</h3>
      <div class="grid">
        <div><div class="field-label">Asset ID</div><div id="assetId" class="field-value"></div></div>
        <div><div class="field-label">Device Name</div><div id="deviceName" class="field-value"></div></div>
        <div><div class="field-label">Type</div><div id="assetType" class="field-value"></div></div>
        <div><div class="field-label">Manufacturer</div><div id="manufacturer" class="field-value"></div></div>
        <div><div class="field-label">Serial</div><div id="serialNumber" class="field-value"></div></div>
        <div><div class="field-label">Status</div><span id="status" class="status"></span></div>
      </div>
    </section>

  </main>
</div>

<script src="sidebar.js"></script>
<script type="module">
import { db, watchAuth } from "./firebase.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const id = new URLSearchParams(location.search).get("id");
const set = (i,v)=>document.getElementById(i).textContent=v||"‚Äì";

watchAuth({
  allowedRoles:["admin","it","viewer"],
  whoEl:document.getElementById("who"),
  onReady:async(_,role)=>{
    if(!id) return;
    document.getElementById("qrLink").href=`qr-generator.html?id=${id}`;
    if(role==="viewer") document.getElementById("editLink").style.display="none";
    else document.getElementById("editLink").href=`item-form.html?id=${id}`;

    const snap=await getDoc(doc(db,"items",id));
    if(!snap.exists()) return;
    const d=snap.data();
    set("title",d.deviceName||"Device");
    set("subtitle",d.assetType||"");
    set("assetId",d.assetId);
    set("deviceName",d.deviceName);
    set("assetType",d.assetType);
    set("manufacturer",d.manufacturer);
    set("serialNumber",d.serialNumber);
    set("status",d.status);
  }
});
</script>
</body>
</html>
