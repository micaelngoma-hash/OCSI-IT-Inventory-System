<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Generate QR – OCSI</title>
<style>
body{font-family:system-ui;background:#f5f7fb;padding:30px;text-align:center;}
.card{background:white;padding:20px;max-width:420px;margin:auto;border-radius:14px;border:1px solid #e5e7eb;}
#qr svg{width:100%;}
button{padding:10px 18px;border-radius:999px;border:none;margin:8px;cursor:pointer;}
.primary{background:#1a73e8;color:white;}
</style>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script type="module">
import { db } from "./firebase.js";
import { doc,getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const id=new URLSearchParams(location.search).get("id");
const qr=document.getElementById("qr");

(async()=>{
  if(!id) return;
  const snap=await getDoc(doc(db,"items",id));
  if(!snap.exists()) return;
  const svg=await window.QRCode.toString(id,{type:"svg",scale:12,errorCorrectionLevel:"H"});
  qr.innerHTML=svg;
  document.getElementById("download").onclick=()=>{
    const b=new Blob([svg],{type:"image/svg+xml"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(b);
    a.download=`QR-${id}.svg`;
    a.click();
  };
})();
</script>
</head>
<body>
<h2>Device QR Code</h2>
<div class="card">
  <div id="qr"></div>
  <button id="download" class="primary">⬇ Download SVG</button>
</div>
</body>
</html>
