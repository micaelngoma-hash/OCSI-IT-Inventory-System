<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generate QR Code – OCSI IT Inventory</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

<style>
body{font-family:system-ui;background:#f5f7fb;padding:30px;text-align:center;}
.card{
  background:white;padding:20px;max-width:420px;margin:auto;
  border-radius:14px;border:1px solid #e5e7eb;
}
canvas{max-width:100%;height:auto;}
button{padding:10px 18px;border-radius:999px;border:none;cursor:pointer;margin:10px;}
.btn-primary{background:#1a73e8;color:white;}
</style>
</head>

<body>
<h1>QR Code</h1>
<div class="card">
  <h2 id="deviceName">Loading…</h2>
  <p>Asset ID: <span id="assetId"></span></p>
  <div id="qrBox"></div>
  <button id="btnDownload" class="btn-primary">⬇ Download PNG</button>
</div>

<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const id=new URLSearchParams(location.search).get("id");
const nameEl=document.getElementById("deviceName");
const assetEl=document.getElementById("assetId");
const qrBox=document.getElementById("qrBox");
const btn=document.getElementById("btnDownload");

const snap=await getDoc(doc(db,"items",id));
if(!snap.exists()){nameEl.textContent="Not found";throw "";}

const d=snap.data();
nameEl.textContent=d.deviceName||"Device";
assetEl.textContent=d.assetId||"";

const canvas=document.createElement("canvas");
await QRCode.toCanvas(canvas,`${location.origin}/item.html?id=${id}`,{
  width:280,margin:2,errorCorrectionLevel:"H"
});
qrBox.appendChild(canvas);

btn.onclick=()=>{
  const a=document.createElement("a");
  a.href=canvas.toDataURL("image/png");
  a.download=`OCSI-${id}.png`;
  a.click();
};
</script>
</body>
</html>
